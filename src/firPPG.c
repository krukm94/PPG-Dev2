/*
 * fir.c
 *
 *  Created on: 07.02.2018
 *      Author: opetany
 */

#include <firPPG.h>

#define N 396

uint32_t x[N]={0};

float h[N] = {

		-0.0001587281586,-0.0004847387318,-0.0009799698601,-0.001464629197,-0.001632648753,
		  -0.001183541957,-1.966027048e-05, 0.001613940694, 0.003165028058, 0.004012369085,
		   0.003798897378, 0.002662614221, 0.001200600876,0.0001546471176,-8.665926543e-06,
		  0.0006365526933, 0.001542260521,  0.00205120421, 0.001824137173, 0.001044828328,
		  0.0002667258959,1.170864198e-05,0.0004057524493, 0.001107725082, 0.001575714909,
		   0.001469946001,0.0008940518601,0.0003004774626,0.0001375838183,0.0005099546979,
		   0.001108746044, 0.001460468862, 0.001297538867,0.0007618676755,0.0002853682672,
		  0.0002446441504,0.0006634711172, 0.001198149752, 0.001415582024, 0.001141249668,
		  0.0005984564195, 0.000226817021,0.0003256188938, 0.000810025027,  0.00127864629,
		   0.001339880633,0.0009333145572,0.0003828812623, 0.000134591668,0.0003897490387,
		  0.0009343041456, 0.001308896346, 0.001185746049,0.0006443735911, 0.000114550945,
		  2.585674883e-05,0.0004483341472,  0.00102403597, 0.001255078008,0.0009176612366,
		  0.0002587467607,-0.0001968209835,-7.959698996e-05,0.0005073876819,  0.00105903903,
		   0.001080852235, 0.000507965975,-0.0002235835855,-0.0005273542483,-0.0001584583952,
		   0.000564590795, 0.001007675426,0.0007476569735,-5.83040528e-05,-0.0007818312733,
		  -0.0008389076684,-0.0001903184748,0.0006007706397,0.0008232540567,0.0002195737325,
		  -0.0007733040256,-0.001366331824,-0.001078273635,-0.0001625605073,0.0005759102642,
		  0.0004458666081,-0.0005312361172,-0.001605869387,-0.001910247374,-0.001199200633,
		  -9.113502892e-05, 0.000422812067,-0.0001853918948,-0.001503052074,-0.002486768179,
		  -0.002331651049, -0.00117750105,-3.432262383e-05,4.729205466e-05,-0.001118178945,
		   -0.00264833495,-0.003303234698,-0.002540215151,-0.001017772709,-8.486996376e-05,
		  -0.0006470224471,-0.002360018902,-0.003866232699,-0.003920969553,-0.002477120375,
		  -0.0007854882278,-0.0003743456618,-0.001737273531,-0.003853376722,-0.004998185206,
		  -0.004205965437,-0.002146160463,-0.0006230881554,-0.001064418699,-0.003261327511,
		  -0.005468307994,-0.005844368599,-0.004049736541,-0.001616783789,-0.0007104298566,
		  -0.002275389619,-0.005152114667,-0.006980407052,-0.006194612477, -0.00342795928,
		  -0.001072337967,-0.001282820129,-0.004086507484,-0.007249810267,-0.008110508323,
		  -0.005878368393,-0.002421714365,-0.0007748635253,-0.002549800789,-0.006453761831,
		  -0.009265186265,-0.008546064608,-0.004814286251,-0.001249498921,-0.001056720852,
		   -0.00466470141,-0.009198783897, -0.01081391796,-0.008005975746,-0.003059867769,
		  -0.000263041642,-0.002264174633,-0.007657685783,  -0.0119792074, -0.01143940445,
		  -0.006287735421,-0.000837620988,7.055533933e-05,-0.004713408183, -0.01140686218,
		   -0.01430255082, -0.01066036429,-0.003313027089, 0.001451312914,-0.0008128261543,
		  -0.008664586581, -0.01562623493, -0.01552629098,-0.007965902798, 0.000887893606,
		   0.003233554075,-0.003602480516, -0.01437674928, -0.01989310235, -0.01479857694,
		   -0.00267759664, 0.006284744479, 0.003699146444,-0.009390006773, -0.02243204601,
		   -0.02370888926, -0.01064333506, 0.006782663055,  0.01332082972, 0.001368427183,
		   -0.02111458965, -0.03531039506, -0.02658553794, 0.001640905859,  0.02739586309,
		    0.02574837208,-0.009769360535, -0.05653841794, -0.07347042114, -0.02813212015,
		    0.07760244608,   0.2023253292,   0.2862256765,   0.2862256765,   0.2023253292,
		    0.07760244608, -0.02813212015, -0.07347042114, -0.05653841794,-0.009769360535,
		    0.02574837208,  0.02739586309, 0.001640905859, -0.02658553794, -0.03531039506,
		   -0.02111458965, 0.001368427183,  0.01332082972, 0.006782663055, -0.01064333506,
		   -0.02370888926, -0.02243204601,-0.009390006773, 0.003699146444, 0.006284744479,
		   -0.00267759664, -0.01479857694, -0.01989310235, -0.01437674928,-0.003602480516,
		   0.003233554075, 0.000887893606,-0.007965902798, -0.01552629098, -0.01562623493,
		  -0.008664586581,-0.0008128261543, 0.001451312914,-0.003313027089, -0.01066036429,
		   -0.01430255082, -0.01140686218,-0.004713408183,7.055533933e-05,-0.000837620988,
		  -0.006287735421, -0.01143940445,  -0.0119792074,-0.007657685783,-0.002264174633,
		  -0.000263041642,-0.003059867769,-0.008005975746, -0.01081391796,-0.009198783897,
		   -0.00466470141,-0.001056720852,-0.001249498921,-0.004814286251,-0.008546064608,
		  -0.009265186265,-0.006453761831,-0.002549800789,-0.0007748635253,-0.002421714365,
		  -0.005878368393,-0.008110508323,-0.007249810267,-0.004086507484,-0.001282820129,
		  -0.001072337967, -0.00342795928,-0.006194612477,-0.006980407052,-0.005152114667,
		  -0.002275389619,-0.0007104298566,-0.001616783789,-0.004049736541,-0.005844368599,
		  -0.005468307994,-0.003261327511,-0.001064418699,-0.0006230881554,-0.002146160463,
		  -0.004205965437,-0.004998185206,-0.003853376722,-0.001737273531,-0.0003743456618,
		  -0.0007854882278,-0.002477120375,-0.003920969553,-0.003866232699,-0.002360018902,
		  -0.0006470224471,-8.486996376e-05,-0.001017772709,-0.002540215151,-0.003303234698,
		   -0.00264833495,-0.001118178945,4.729205466e-05,-3.432262383e-05, -0.00117750105,
		  -0.002331651049,-0.002486768179,-0.001503052074,-0.0001853918948, 0.000422812067,
		  -9.113502892e-05,-0.001199200633,-0.001910247374,-0.001605869387,-0.0005312361172,
		  0.0004458666081,0.0005759102642,-0.0001625605073,-0.001078273635,-0.001366331824,
		  -0.0007733040256,0.0002195737325,0.0008232540567,0.0006007706397,-0.0001903184748,
		  -0.0008389076684,-0.0007818312733,-5.83040528e-05,0.0007476569735, 0.001007675426,
		   0.000564590795,-0.0001584583952,-0.0005273542483,-0.0002235835855, 0.000507965975,
		   0.001080852235,  0.00105903903,0.0005073876819,-7.959698996e-05,-0.0001968209835,
		  0.0002587467607,0.0009176612366, 0.001255078008,  0.00102403597,0.0004483341472,
		  2.585674883e-05, 0.000114550945,0.0006443735911, 0.001185746049, 0.001308896346,
		  0.0009343041456,0.0003897490387, 0.000134591668,0.0003828812623,0.0009333145572,
		   0.001339880633,  0.00127864629, 0.000810025027,0.0003256188938, 0.000226817021,
		  0.0005984564195, 0.001141249668, 0.001415582024, 0.001198149752,0.0006634711172,
		  0.0002446441504,0.0002853682672,0.0007618676755, 0.001297538867, 0.001460468862,
		   0.001108746044,0.0005099546979,0.0001375838183,0.0003004774626,0.0008940518601,
		   0.001469946001, 0.001575714909, 0.001107725082,0.0004057524493,1.170864198e-05,
		  0.0002667258959, 0.001044828328, 0.001824137173,  0.00205120421, 0.001542260521,
		  0.0006365526933,-8.665926543e-06,0.0001546471176, 0.001200600876, 0.002662614221,
		   0.003798897378, 0.004012369085, 0.003165028058, 0.001613940694,-1.966027048e-05,
		  -0.001183541957,-0.001632648753,-0.001464629197,-0.0009799698601,-0.0004847387318,
		  -0.0001587281586
};

float firFilterPPG(uint32_t sample)
{
	float y = 0;
	uint16_t i = 0;

	for(i = 0; i < N; i++)
	{
		y = y + x[i]*h[N-i];
	}

	for(i = 0; i < (N-1); i++)
	{
		x[i] = x[i+1];
	}

	x[N-1] = sample;

	return y;
}
